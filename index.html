<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>¬øQuieres ser mi San Valent√≠n? üíò</title>
  <meta name="description" content="Una pregunta importante üíò" />

  <!-- GSAP para la intro -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <style>
    :root{
      --bg1:#0b0b16;
      --bg2:#2a0f2f;
      --hot:#ff4d6d;
      --hot2:#ff8fab;
      --vio:#c77dff;
      --card:#ffffff10;
      --border:#ffffff22;
      --txt:#fff;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      overflow:hidden;
      display:grid;
      place-items:center;
      padding:24px;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
    }

    /* ===== INTRO OVERLAY ===== */
    #intro{
      position: fixed;
      inset: 0;
      background: rgb(14, 16, 15);
      z-index: 9999;
      overflow: hidden;
      cursor: pointer;
      opacity: 1;
    }
    #introCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }
    .intro-ui{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      text-align:center;
      padding: 24px;
      pointer-events:none;
    }
    .intro-title{
      font-size: clamp(26px, 4vw, 48px);
      font-weight: 900;
      letter-spacing: .2px;
      margin-bottom: 10px;
      text-shadow: 0 18px 40px rgba(0,0,0,.5);
    }
    .intro-cta{
      display:inline-block;
      margin-top: 6px;
      padding: 12px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.20);
      font-weight: 800;
      opacity: .92;
      animation: ctaPulse 1.1s ease-in-out infinite;
    }
    @keyframes ctaPulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.06); }
    }

    /* Ocultar/mostrar app */
    .hidden{ display:none; }

    /* Fondo animado */
    .bg{
      position:fixed; inset:-20%;
      background:
        radial-gradient(900px 700px at 20% 20%, #ff4d6d2e, transparent 60%),
        radial-gradient(900px 700px at 80% 30%, #c77dff2b, transparent 55%),
        radial-gradient(700px 600px at 40% 85%, #ff8fab26, transparent 55%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      filter: saturate(120%);
      animation: drift 10s ease-in-out infinite alternate;
      z-index:-3;
    }
    @keyframes drift{
      0%{ transform: translate3d(-1%, -1%, 0) scale(1.02); }
      100%{ transform: translate3d(1%, 1%, 0) scale(1.06); }
    }

    /* Brillitos */
    .glow{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 10% 30%, #ffffff10 0 2px, transparent 3px),
        radial-gradient(circle at 60% 10%, #ffffff12 0 1.5px, transparent 3px),
        radial-gradient(circle at 80% 70%, #ffffff10 0 2px, transparent 3px),
        radial-gradient(circle at 30% 80%, #ffffff12 0 1.5px, transparent 3px);
      opacity:.55;
      animation: twinkle 3.5s ease-in-out infinite;
      z-index:-2;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.35; transform: translateY(0); }
      50%{ opacity:.7; transform: translateY(-6px); }
    }

    /* Corazones flotantes */
    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-1;
      opacity:.9;
    }
    .heart{
      position:absolute;
      font-size:18px;
      filter: drop-shadow(0 10px 18px #ff4d6d35);
      animation: floatUp linear infinite;
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{ transform: translateY(110vh) translateX(0) scale(.9); opacity:0; }
      10%{ opacity:.9; }
      100%{ transform: translateY(-20vh) translateX(40px) scale(1.25); opacity:0; }
    }

    /* Card principal */
    .card{
      width:min(760px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:26px;
      padding:28px;
      backdrop-filter: blur(12px);
      box-shadow: 0 22px 70px #00000066;
      position:relative;
      transform: translateZ(0);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:9px 12px;
      border-radius:999px;
      background:#ffffff12;
      border:1px solid #ffffff22;
      font-size:14px;
      letter-spacing:.2px;
    }

    .kitty-fixed.left{
      left: 18px;
      right: auto;
      bottom: 18px;
      transform: scaleX(-1); /* mira hacia el centro */
    }
    .kitty-fixed.top-left{
      top: 18px;
      left: 18px;
      right: auto;
      bottom: auto;
      transform: scaleX(-1); /* mira hacia el centro */
    }
    @media (max-width: 480px){
      .kitty-fixed.top-left{
        width: 130px;
        top: 70px;
        left: 8px;
      }
    }

    h1{
      margin:14px 0 10px;
      font-size: clamp(28px, 4vw, 46px);
      line-height:1.08;
    }
    p{
      margin:0 0 18px;
      opacity:.92;
      font-size:16px;
      max-width: 60ch;
    }

    .spark{
      position:absolute; right:18px; top:18px;
      font-size:34px;
      animation: bob 2.8s ease-in-out infinite;
      filter: drop-shadow(0 10px 18px #ff4d6d55);
      user-select:none;
    }
    @keyframes bob{ 0%,100%{ transform:translateY(0) } 50%{ transform:translateY(-8px) } }

    .row{
      margin-top:12px;
      position:relative;
      min-height: 58px;
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:0;
      padding:14px 18px;
      border-radius:14px;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    button:active{ transform: translateY(0) scale(.99); }

    #yes{
      background: linear-gradient(135deg, var(--hot), var(--hot2));
      color:#1a0610;
      box-shadow: 0 14px 30px #ff4d6d35;
    }
    #no{
      background:#ffffff12;
      color:var(--txt);
      border:1px solid #ffffff33;
      box-shadow: 0 12px 24px #00000025;
      position:relative; /* se vuelve absolute cuando se ‚Äúescape‚Äù */
    }

    /* Modal */
    #modal{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background:#00000088;
      z-index:30;
      padding:20px;
    }
    #modal .inner{
      width:min(640px, 92vw);
      background:#0b0b14;
      border:1px solid #ffffff22;
      border-radius:22px;
      padding:22px;
      text-align:center;
      box-shadow: 0 30px 90px #000000aa;
      animation: pop .18s ease-out;
    }
    @keyframes pop{
      from{ transform: translateY(8px) scale(.98); opacity:.6; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }
    #modal .big{ font-size:54px; margin: 10px 0; }
    #modal h2{ margin: 6px 0 10px; font-size:28px; }
    #modal p{ margin: 0 0 10px; opacity:.92; }
    #close{
      margin-top: 8px;
      background:#ffffff14;
      color:#fff;
      border:1px solid #ffffff2a;
    }

    /* Canvas confeti */
    canvas{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:20;
    }

    /* Hello Kitty fija abajo a la derecha */
    .kitty-fixed{
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 220px;
      max-width: 40vw;
      z-index: 25; /* por encima del fondo, debajo del modal */
      pointer-events: none; /* no interfiere con botones */
      filter: drop-shadow(0 14px 24px rgba(0,0,0,.45));
      animation: kittyBounce 1.1s ease-in-out infinite;
    }

    /* animaci√≥n extra (adem√°s del GIF) */
    @keyframes kittyBounce{
      0%   { transform: translateY(0) rotate(-2deg); }
      50%  { transform: translateY(-6px) rotate(2deg); }
      100% { transform: translateY(0) rotate(-2deg); }
    }

    /* Mobile: m√°s peque√±a */
    @media (max-width: 480px){
      .kitty-fixed{
        width: 160px;
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- INTRO -->
  <div id="intro" role="button" aria-label="Haz click para continuar">
    <canvas id="introCanvas"></canvas>
    <div class="intro-ui">
      <div>
        <div class="intro-title">Tengo algo que preguntarte üíò</div>
        <div class="intro-cta">Haz click para continuar</div>
      </div>
    </div>
  </div>

  <!-- APP (tu p√°gina) -->
  <div id="app" class="hidden">
    <div class="bg"></div>
    <div class="glow"></div>
    <div class="hearts" id="hearts"></div>
    <canvas id="confetti"></canvas>

    <main class="card" id="card">
      <div class="badge">üíå <span id="who">Oye, amorrr</span></div>
      <div class="spark">üíò</div>

      <h1>¬øQuieres ser mi San Valent√≠n?</h1>
      <p>Antes de que alguien mas te lo pida!</p>

      <section class="row" id="row">
        <button id="yes">S√≠ üíñ</button>
        <button id="no">No üò∂</button>
      </section>
    </main>

    <div id="modal" role="dialog" aria-modal="true" aria-label="Celebraci√≥n">
      <div class="inner">
        <div class="big">üéâüíûüéâ</div>
        <h2>¬°SAB√çA QUE DIR√çAS QUE S√ç!</h2>
        <p id="finalMsg">Oficialmente lo eres amor!</p>
        <button id="close">Cerrar</button>
      </div>
    </div>

    <div class="kitty-fixed">
      <div class="tenor-gif-embed"
          data-postid="6682255795123802665"
          data-share-method="host"
          data-aspect-ratio="1.57895"
          data-width="100%">
        <a href="https://tenor.com/view/hello-kitty-gif-6682255795123802665">Hello Kitty Sticker</a>
      </div>
    </div>

    <div class="kitty-fixed top-left">
      <div class="tenor-gif-embed"
          data-postid="19413573"
          data-share-method="host"
          data-aspect-ratio="1"
          data-width="100%">
        <a href="https://tenor.com/view/kitty-gif-19413573">Kitty Sticker</a>
      </div>
    </div>
  </div>

  <script>
    // ===== INTRO ANIMATION (tu c√≥digo, adaptado) =====
    const intro = document.getElementById("intro");
    const introCanvas = document.getElementById("introCanvas");
    const introCtx = introCanvas.getContext("2d");

    let cw = (introCanvas.width = window.innerWidth);
    let ch = (introCanvas.height = window.innerHeight);
    let radius = Math.max(cw, ch);

    const particles = Array(99);

    for (let i = 0; i < particles.length; i++) {
      particles[i] = {
        x: 0,
        y: 0,
        scale: 0,
        rotate: 0,
        img: new Image()
      };
      particles[i].img.src = "https://assets.codepen.io/16327/flair-" + (2 + (i % 21)) + ".png";
    }

    function drawIntro() {
      particles.sort((a, b) => a.scale - b.scale);
      introCtx.clearRect(0, 0, cw, ch);

      particles.forEach((p) => {
        introCtx.translate(cw / 2, ch / 2);
        introCtx.rotate(p.rotate);
        introCtx.drawImage(
          p.img,
          p.x,
          p.y,
          p.img.width * p.scale,
          p.img.height * p.scale
        );
        introCtx.resetTransform();
      });
    }

    const tl = gsap.timeline({ onUpdate: drawIntro })
      .fromTo(particles, {
        x: (i) => {
          const angle = (i / particles.length * Math.PI * 2) - Math.PI / 2;
          return Math.cos(angle * 10) * radius;
        },
        y: (i) => {
          const angle = (i / particles.length * Math.PI * 2) - Math.PI / 2;
          return Math.sin(angle * 10) * radius;
        },
        scale: 1.1,
        rotate: 0
      }, {
        duration: 5,
        ease: "sine",
        x: 0,
        y: 0,
        scale: 0,
        rotate: -3,
        stagger: { each: -0.05, repeat: -1 }
      }, 0);

    // mantiene la idea de "seek(99)" pero sin depender de que exista ese tiempo exacto
    tl.play(0);

    function resizeIntro() {
      cw = introCanvas.width = innerWidth;
      ch = introCanvas.height = innerHeight;
      radius = Math.max(cw, ch);
      tl.invalidate();
      drawIntro();
    }

    window.addEventListener("resize", resizeIntro);

    // Click en intro => mostrar app
    let started = false;
    intro.addEventListener("pointerup", () => {
      if (started) return;
      started = true;

      gsap.to(tl, { timeScale: 0, duration: 0.25 });

      gsap.to(intro, {
        opacity: 0,
        duration: 0.6,
        ease: "power2.out",
        onComplete: () => {
          intro.remove();
          document.getElementById("app").classList.remove("hidden");
          // dispara resize para ajustar confeti + hearts si hace falta
          window.dispatchEvent(new Event("resize"));
        }
      });
    }, { passive: true });
  </script>

  <script>
    // ===== TU JS ORIGINAL (sin cambiar tu texto) =====

    // ===== Personalizaci√≥n por URL =====
    const params = new URLSearchParams(location.search);
    const n = params.get("n");
    const m = params.get("m");
    if (n) document.getElementById("who").textContent = `Oye, ${n}`;
    if (m) document.getElementById("finalMsg").textContent = m;

    // ===== Corazones flotantes =====
    const hearts = document.getElementById("hearts");
    const heartChars = ["üíó","üíñ","üíò","üíù","üíû","üíï"];
    const heartCount = 18;

    function spawnHearts(){
      hearts.innerHTML = "";
      for(let i=0;i<heartCount;i++){
        const el = document.createElement("div");
        el.className = "heart";
        el.textContent = heartChars[(Math.random()*heartChars.length)|0];
        el.style.left = (Math.random()*100).toFixed(2) + "vw";
        el.style.animationDuration = (7 + Math.random()*6).toFixed(2) + "s";
        el.style.animationDelay = (Math.random()*-10).toFixed(2) + "s";
        el.style.fontSize = (14 + Math.random()*18).toFixed(0) + "px";
        hearts.appendChild(el);
      }
    }
    spawnHearts();

    // ===== Bot√≥n NO que se escapa =====
    const noBtn = document.getElementById("no");
    const row = document.getElementById("row");
    let dodges = 0;

    function moveNoButton(){
      const rect = row.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const maxX = Math.max(0, rect.width - btnRect.width);
      const maxY = Math.max(0, rect.height - btnRect.height);

      const x = Math.random() * maxX;
      const y = Math.random() * maxY;

      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";

      dodges++;
      if (dodges === 4) noBtn.textContent = "¬øSegura? üò≥";
      if (dodges === 7) noBtn.textContent = "No se vale üôÉ";
      if (dodges >= 10) noBtn.textContent = "Di que s√≠ üòå";
    }

    ["mouseenter","pointerenter","touchstart"].forEach(evt => {
      noBtn.addEventListener(evt, (e) => { e.preventDefault(); moveNoButton(); }, {passive:false});
    });

    // ===== Modal + Confeti =====
    const yesBtn = document.getElementById("yes");
    const modal = document.getElementById("modal");
    const closeBtn = document.getElementById("close");

    yesBtn.addEventListener("click", () => {
      modal.style.display = "grid";
      burstConfetti();
    });

    closeBtn.addEventListener("click", () => modal.style.display = "none");
    modal.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

    // ===== Confeti (canvas) =====
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let confetti = [];
    let raf = null;
    let dpr = 1;

    function resizeCanvas(){
      dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resizeCanvas();
    window.addEventListener("resize", () => {
      resizeCanvas();
      spawnHearts();
    });

    function burstConfetti(){
      const cx = window.innerWidth / 2;
      const cy = window.innerHeight / 2;
      const count = 200;

      confetti = [];
      for(let i=0;i<count;i++){
        const hue = (Math.random()*360)|0;
        confetti.push({
          x: cx,
          y: cy,
          vx: (Math.random()-0.5) * 12,
          vy: (Math.random()-0.9) * 14,
          g: 0.28 + Math.random()*0.08,
          w: 4 + Math.random()*6,
          h: 3 + Math.random()*5,
          r: Math.random()*Math.PI*2,
          vr:(Math.random()-0.5)*0.25,
          a: 1,
          life: 130 + (Math.random()*40)|0,
          hue
        });
      }

      cancelAnimationFrame(raf);
      tick();
    }

    function tick(){
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      for(const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.vy += p.g;
        p.r += p.vr;
        p.life -= 1;

        p.a = Math.max(0, Math.min(1, p.life / 140));

        ctx.save();
        ctx.globalAlpha = p.a;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.r);
        ctx.fillStyle = `hsl(${p.hue} 90% 70%)`;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      }

      confetti = confetti.filter(p => p.life > 0 && p.y < window.innerHeight + 50);
      if(confetti.length){
        raf = requestAnimationFrame(tick);
      } else {
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      }
    }
  </script>

  <!-- Tenor (solo una vez) -->
  <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
</body>
</html>
